@startuml
actor 利用者
participant システム
database DB
participant "音声プレイヤー" as Player
participant "ネットワーク" as Network

利用者 -> システム : 通知スケジュール起動（指定時刻）

システム -> Network : 通信確認
alt ネットワーク不安定
    システム -> Network : 再送を試みる（リトライ）
end

システム -> DB : 通知スケジュール確認
DB --> システム : 通知情報を返す

alt 通知オフ
    システム -> DB : 通知履歴を保存（未通知分）
    DB --> システム : 保存完了
    システム --> 利用者 : （次回起動時にまとめて表示予定）
else 通知オン
    システム -> DB : タスク／ボイスレターデータ取得
    DB --> システム : タスク・音声データ返却

    alt 音声ファイル見つからない
        システム -> 利用者 : 代替テキスト通知を表示
    else 音声ファイルあり
        システム -> Player : 音声ファイル再生要求
        Player --> システム : 再生開始通知
        システム -> 利用者 : 通知内容（テキスト）表示
    end

    利用者 -> システム : タスク詳細を開く or 完了操作
    システム -> DB : 再生ログ保存（通知履歴）
    DB --> システム : 保存完了
    システム --> 利用者 : 完了メッセージ表示
end
@enduml
